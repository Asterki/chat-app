(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[658],{2:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat/[user]",function(){return c(8215)}])},8215:function(a,b,c){"use strict";c.r(b),c.d(b,{"__N_SSP":function(){return E},default:function(){return F}});var d=c(828),e=c(9815),f=c(5893),g=c(7294),h=c(3264),i=c(2474),j=c.n(i),k=c(9008),l=c.n(k),m=c(1237),n=c(9620),o=c.n(n),p=c(562),q=c(4731),r=function(a){return(0,f.jsx)("div",{className:o().component,children:(0,f.jsxs)("div",{className:o()["contact-info"],children:[(0,f.jsx)(p.Z,{onClick:a.return,children:(0,f.jsx)(m.Z,{})}),(0,f.jsx)(q.Z,{className:o()["contact-avatar"],src:"/avatars/".concat(a.contactUserID,".png")}),(0,f.jsx)("div",{className:o()["contact-general"],children:(0,f.jsx)("p",{className:o()["contact-username"],children:a.contactUsername})})]})})},s=r,t=c(6648),u=c.n(t),v=function(a){var b=new Date(a.timestamp),c=b.getHours(),d=1==b.getMinutes().toString().length?"0".concat(b.getMinutes().toString()):b.getMinutes();return(0,f.jsx)("div",{className:u().component,children:(0,f.jsx)("div",{className:a.sentByMe?u()["by-me"]:u()["not-by-me"],children:(0,f.jsxs)("div",{className:u().content,children:[(0,f.jsx)("p",{children:a.content}),(0,f.jsx)("p",{className:u().timestamp,children:"".concat(c,":").concat(d)})]})})})},w=v,x=c(7598),y=c(682),z=c(5365),A=c(9895),B=c.n(A),C=c(8764).Buffer,D=function(a){var b=(0,d.Z)(g.useState([]),2),c=b[0],i=b[1],k=(0,d.Z)(g.useState({}),2),m=k[0],n=k[1],o=(0,h.io)(a.host);o.on("message",function(b){b.author!=a.user.username&&n(b)});var q=function(b){var c=j().randomBytes(16),d=j().createCipheriv("aes-256-ctr",a.chatKey,c),e=C.concat([d.update(b),d.final()]);return{iv:c.toString("hex"),content:e.toString("hex")}},r=function(b){var c=j().createDecipheriv("aes-256-ctr",a.chatKey,C.from(b.iv,"hex"));return C.concat([c.update(C.from(b.content,"hex")),c.final()]).toString()},t=function(b){document.querySelector("#message-input").focus();var c=document.querySelector("#message-input").value;c&&(document.querySelector("#message-input").value="",u({author:a.user.username,recipient:a.contact,timestamp:Date.now(),content:c}),o.emit("message",{author:a.user.username,recipient:a.contact,timestamp:Date.now(),content:q(c)}))},u=function(b,d){b.author!==a.user.username&& !1==d&&(b.content=r(b.content));var f=(0,e.Z)(c).concat([b]);i(f);var g=localStorage.getItem("chat_".concat(a.contact));if(g||(g="[]"),!0!=d){var h=JSON.parse(g);h.push(b),localStorage.setItem("chat_".concat(a.contact),JSON.stringify(h))}},v=function(){return window.location.href="/home"},A=function(){return localStorage.clear()};return g.useEffect(function(){o.on("connect",function(){o.emit("join-chat",{user:a.user.username,contact:a.contact})});var b=localStorage.getItem("chat_".concat(a.contact));if(b){var c=JSON.parse(b);i(c)}},[]),g.useEffect(function(){if(void 0!=m.author){if(!0==m.fromStored)return u(m,!0);u(m,!1)}},[m]),(0,f.jsxs)("div",{className:B().page,children:[(0,f.jsx)(s,{return:v,contactUsername:a.contact,contactUserID:a.contactUserID}),(0,f.jsx)(l(),{children:(0,f.jsx)("title",{children:a.lang.pageTitle})}),(0,f.jsxs)(y.Z,{className:B().messages,children:[(0,f.jsx)("br",{}),(0,f.jsx)("p",{className:B().intro,children:"This is the start of your chat"}),(0,f.jsx)("br",{}),c.map(function(b){return(0,f.jsx)(w,{timestamp:b.timestamp,sentByMe:b.author==a.user.username,content:b.content,type:"text"},"".concat(1e3*Math.random()," ").concat(b.author))}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{}),(0,f.jsx)("br",{})]}),(0,f.jsxs)(y.Z,{fluid:!0,className:B()["chat-bar"],children:[(0,f.jsx)(x.Z,{className:B()["message-input"],id:"message-input",maxRows:3,placeholder:"Message..."}),(0,f.jsx)(p.Z,{onClick:t,children:(0,f.jsx)(z.Z,{})}),(0,f.jsx)(p.Z,{onClick:A,children:(0,f.jsx)(z.Z,{})})]})]})},E=!0,F=D},9620:function(a){a.exports={component:"chatNavbar_component__etMbJ","contact-info":"chatNavbar_contact-info__pupUH","contact-general":"chatNavbar_contact-general__ZoKzI","contact-username":"chatNavbar_contact-username__6HcK8","contact-avatar":"chatNavbar_contact-avatar__Zf2bK"}},6648:function(a){a.exports={component:"message_component__GVaMC","by-me":"message_by-me__Du9h9",content:"message_content__BryaQ",timestamp:"message_timestamp__Jbq6C","not-by-me":"message_not-by-me__7w_fU"}},9895:function(a){a.exports={page:"chat_page__MxOtX",intro:"chat_intro__t5J12","chat-bar":"chat_chat-bar__yaeYo","message-input":"chat_message-input__UawLr"}}},function(a){a.O(0,[714,277,612,161,837,602,774,888,179],function(){var b;return a(a.s=2)}),_N_E=a.O()}])